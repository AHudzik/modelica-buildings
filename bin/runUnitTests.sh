#!/bin/bash
######################################################################
# Script to run all unit tests
#
#
######################################################################
fl=`find . -name '*.mos'`
curDir=`pwd`
if [ `basename $curDir` != "Buildings" ]; then
    echo "*** Error. Program must be run from directory 'Buildings'"
    echo "*** Exit with error without doing anything."
    exit 1
fi

MOSFIL=runAll.mos

echo "Generating script to run all examples."

echo "// File autogenerated by `whoami`. Do not edit." > $MOSFIL
echo "openModel(\"package.mo\");" >> $MOSFIL
for ff in $fl; do
    grep "simulateModel" $ff > /dev/null
    if [ $? == 0 ]; then
	FILNAM=`basename $ff`
	DIRNAM=`dirname $ff`
	echo "cd $DIRNAM" >> $MOSFIL
	echo "RunScript(\"$FILNAM\");" >> $MOSFIL
	echo "cd $curDir" >> $MOSFIL
    fi
done

echo "Running Dymola"
dymola6 $MOSFIL